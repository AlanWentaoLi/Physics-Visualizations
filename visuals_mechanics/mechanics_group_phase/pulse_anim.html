<html>

<head>
    <title>Pulse Anim</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!--<script src="jquery-2.1.1.js"></script>-->
</head>
<body>

<div id='graph'></div>  <!-- Plotly chart will be drawn inside this DIV -->

<div id="content"></div>
    	<!-- Put content here to make them central aligned -->
        <!--<h1>Home Page</h1> -->
        alpha: <input id="alpha" type ="range" value="2" min ="0" max="100.0" step ="0.1"/>
        <input id="run_button" type ="button" value="start" onclick="onstart()"/>

    <script>

    //var alpha = parseFloat($("#alpha").val());


//    $('#alpha').on('change', function () {
//    // To update alpha
//    var alpha = 0.5;
//});

    // Defining variables (need to update later anyway so importing from e.g. json is meaningless)
    var n = 801;
    var x = [], y_i = [], y_r = [], y_t = [];
    var t = 0.0;
    var dt = 0.02;
    var v1 = 10.0;
    var alpha = 0.5;
    var v2 = alpha*v1;
    var A = (v2-v1)/(v1+v2);
    var B = 2*v1/(v1+v2);
    // in his lecture notes B is different, but this is B in the script he sent us.
    // Pretty sure this is right.

    // var what = document.getElementById("ball2Mass").value;

    for (var i = 0; i < n; i++) {
        x[i] = -10 + i / 40;
        y_i[i] = (x[i] + 4) * Math.exp(-((x[i] + 4) * (x[i] + 4)) + (x[i] + 4));
        y_r[i] = 0;
        y_t[i] = 0;
    }

    // Initial plot
    var incident = {
        x: x,
        y: y_i,
        name: "incident",
        line: {width: 1, color: '#ff00ff', simplify: false}
    };

    var reflected = {
        x: x,
        y: y_r,
        name: "reflected",
        line: {width: 1, color: 'blue', simplify: false}
    };

    var transmitted = {
        x: x,
        y: y_t,
        name: "transmitted",
        line: {width: 1, color: 'red', simplify: false}
    };

    var boundary = {
        x: [0,0],
        y: [-1.3,1.3],
        name: "boundary",
        line: {width: 3, color: 'black', simplify: true}
    }

    // Plot graph with interactivity
    Plotly.plot('graph', [incident, reflected, transmitted, boundary], {
                xaxis: {range: [-10, 10]},
//                yaxis: {range: [0, 60]},
//                updatemenus: [{
//                    buttons: [
//                        {method: 'restyle', args: ['line.color', 'blue'], label: 'blue'},
//                        {method: 'restyle', args: ['line.color', 'green'], label: 'green'},
//                        {method: 'restyle', args: ['line.color', 'red'], label: 'red'}
//                    ]
//                }]
            },
            {showlink: false}
    );


   // Data update function for animation
   var t_start = t;

   function compute() {
       t += dt;
       if (t < t_start + 16) {
           for (var i = 0; i < n; i++) {
               if (x[i] < 0) {
                   y_i[i] = (x[i] + 4 - v1 * t) * Math.exp(-((x[i] + 4 - v1 * t) * (x[i] + 4 - v1 * t)) + (x[i] + 4 - v1 * t));
                   y_r[i] = A * (-x[i] + 4 - v1 * t) * Math.exp(-((-x[i] + 4 - v1 * t) * (-x[i] + 4 - v1 * t)) + (-x[i] + 4 - v1 * t));
               }
               else if (x[i] > 0) {
                   y_t[i] = B * (v1 / v2 * x[i] + 4 - v1 * t) * Math.exp(-((v1 / v2 * x[i] + 4 - v1 * t) * (v1 / v2 * x[i] + 4 - v1 * t)) + (v1 / v2 * x[i] + 4 - v1 * t));
               }
           }
       }

   }


   // Looping function that updates plot
   function update() {
       compute();

       Plotly.animate('graph', {
               data: [{y: y_i}, {y: y_r}, {y: y_t}]
           },
           {transition: {duration: 0}, frame: {duration: 0, redraw: false}}
           // vastly speeds up animation but won't update any non-animated properties
       );

       requestAnimationFrame(update);
   }

   function onstart() {
     requestAnimationFrame(update);
}


</script>

</body>
</html>
